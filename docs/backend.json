
{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the Auditgelap application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user.",
          "format": "uuid"
        },
        "uid": {
          "type": "string",
          "description": "The user's unique identifier from the authentication provider."
        },
        "email": {
          "type": "string",
          "description": "The user's email address.",
          "format": "email"
        },
        "name": {
          "type": "string",
          "description": "The user's full name."
        },
        "role": {
          "type": "string",
          "description": "The user's role, determining access levels (free, executioner, war_room).",
          "format": "enum",
          "items": {
            "type": "string"
          }
        },
        "isPremium": {
          "type": "boolean",
          "description": "Indicates whether the user has a premium subscription."
        },
        "statsId": {
          "type": "string",
          "description": "Reference to UserStats. (Relationship: User 1:1 UserStats)"
        },
        "subscriptionId": {
          "type": "string",
          "description": "Reference to Subscription. (Relationship: User 1:1 Subscription)"
        },
        "createdAt": {
          "type": "number",
          "description": "Timestamp indicating when the user account was created."
        }
      },
      "required": [
        "id",
        "uid",
        "email",
        "name",
        "role",
        "isPremium",
        "statsId",
        "subscriptionId",
        "createdAt"
      ]
    },
    "UserStats": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserStats",
      "type": "object",
      "description": "Statistics related to a user's activity within the Auditgelap application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user stats entity.",
          "format": "uuid"
        },
        "totalAudits": {
          "type": "number",
          "description": "The total number of audits performed by the user."
        },
        "totalLossObserved": {
          "type": "number",
          "description": "The accumulated opportunity cost (in IDR) observed by the user."
        },
        "completedCommands": {
          "type": "number",
          "description": "The number of strategic commands completed by the user."
        },
        "failedCommands": {
          "type": "number",
          "description": "The number of strategic commands failed by the user."
        }
      },
      "required": [
        "id",
        "totalAudits",
        "totalLossObserved",
        "completedCommands",
        "failedCommands"
      ]
    },
    "Subscription": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Subscription",
      "type": "object",
      "description": "Represents a user's subscription details for Auditgelap premium features.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the subscription entity.",
          "format": "uuid"
        },
        "planId": {
          "type": "string",
          "description": "The identifier of the subscription plan."
        },
        "status": {
          "type": "string",
          "description": "The current status of the subscription (active, expired).",
          "format": "enum",
          "items": {
            "type": "string"
          }
        },
        "currentPeriodEnd": {
          "type": "number",
          "description": "Timestamp indicating the end of the current subscription period."
        },
        "midtransOrderId": {
          "type": "string",
          "description": "The order ID from Midtrans payment gateway for this subscription."
        }
      },
      "required": [
        "id",
        "planId",
        "status",
        "currentPeriodEnd",
        "midtransOrderId"
      ]
    },
    "AuditLog": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "AuditLog",
      "type": "object",
      "description": "A record of an AI-powered audit performed by a user.",
      "properties": {
        "userId": {
          "type": "string",
          "description": "Reference to the user who performed the audit."
        },
        "input": {
          "type": "object",
          "properties": {
            "excuse": { "type": "string" },
            "monthsDelayed": { "type": "number" },
            "targetIncome": { "type": "number" }
          },
          "required": ["excuse", "monthsDelayed", "targetIncome"]
        },
        "output": {
          "type": "object",
          "properties": {
            "diagnosis_title": { "type": "string" },
            "brutal_diagnosis": { "type": "string" },
            "opportunity_cost_idr": { "type": "number" },
            "dark_analogy": { "type": "string" },
            "strategic_commands": {
              "type": "array",
              "items": { "type": "string" }
            }
          }
        },
        "type": {
          "type": "string",
          "enum": ["standard", "deep_audit"]
        },
        "timestamp": {
          "type": "number",
          "description": "Timestamp when the audit was generated."
        }
      },
      "required": ["userId", "input", "output", "type", "timestamp"]
    },
    "ActiveCommand": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ActiveCommand",
      "type": "object",
      "description": "An actionable command assigned to a user following an audit.",
      "properties": {
        "userId": {
          "type": "string",
          "description": "Reference to the user who received the command."
        },
        "auditId": {
          "type": "string",
          "description": "Reference to the audit log that generated this command."
        },
        "task": {
          "type": "string",
          "description": "The specific action the user must take."
        },
        "deadline": {
          "type": "number",
          "description": "Timestamp indicating when the command expires."
        },
        "status": {
          "type": "string",
          "enum": ["pending", "completed", "failed"],
          "description": "The current state of the command."
        },
        "isPremiumFeature": {
          "type": "boolean",
          "description": "Indicates if this command was generated via a Deep Audit."
        }
      },
      "required": ["userId", "auditId", "task", "deadline", "status", "isPremiumFeature"]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profile information.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/stats/{statsId}",
        "definition": {
          "entityName": "UserStats",
          "schema": {
            "$ref": "#/backend/entities/UserStats"
          },
          "description": "Stores user statistics.",
          "params": [
            { "name": "userId" },
            { "name": "statsId" }
          ]
        }
      },
      {
        "path": "/users/{userId}/subscriptions/{subscriptionId}",
        "definition": {
          "entityName": "Subscription",
          "schema": {
            "$ref": "#/backend/entities/Subscription"
          },
          "description": "Stores user subscription information.",
          "params": [
            { "name": "userId" },
            { "name": "subscriptionId" }
          ]
        }
      },
      {
        "path": "/users/{userId}/audit_logs/{auditId}",
        "definition": {
          "entityName": "AuditLog",
          "schema": {
            "$ref": "#/backend/entities/AuditLog"
          },
          "description": "Stores individual audit reports for the user.",
          "params": [
            { "name": "userId" },
            { "name": "auditId" }
          ]
        }
      },
      {
        "path": "/users/{userId}/active_commands/{commandId}",
        "definition": {
          "entityName": "ActiveCommand",
          "schema": {
            "$ref": "#/backend/entities/ActiveCommand"
          },
          "description": "Stores strategic commands issued to the user.",
          "params": [
            { "name": "userId" },
            { "name": "commandId" }
          ]
        }
      }
    ]
  }
}
