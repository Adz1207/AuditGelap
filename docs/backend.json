
{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the Auditgelap application.",
      "properties": {
        "uid": {
          "type": "string",
          "description": "The user's unique identifier from the authentication provider."
        },
        "email": {
          "type": "string",
          "description": "The user's email address.",
          "format": "email"
        },
        "name": {
          "type": "string",
          "description": "The user's full name."
        },
        "role": {
          "type": "string",
          "description": "Access tier: 'free', 'executioner', or 'war_room'.",
          "enum": ["free", "executioner", "war_room"]
        },
        "isPremium": {
          "type": "boolean",
          "description": "Indicates active premium status."
        },
        "createdAt": {
          "type": "number",
          "description": "Timestamp of account creation."
        }
      },
      "required": ["uid", "email", "name", "role", "isPremium", "createdAt"]
    },
    "UserStats": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserStats",
      "type": "object",
      "description": "Statistics related to a user's activity.",
      "properties": {
        "totalAudits": { "type": "number" },
        "totalLossObserved": { "type": "number" },
        "completedCommands": { "type": "number" },
        "failedCommands": { "type": "number" }
      },
      "required": ["totalAudits", "totalLossObserved", "completedCommands", "failedCommands"]
    },
    "Subscription": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Subscription",
      "type": "object",
      "description": "Details for premium features.",
      "properties": {
        "planId": { "type": "string" },
        "status": { "type": "string", "enum": ["active", "expired"] },
        "currentPeriodEnd": { "type": "number" },
        "midtransOrderId": { "type": "string" }
      },
      "required": ["planId", "status", "currentPeriodEnd", "midtransOrderId"]
    },
    "AuditLog": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "AuditLog",
      "type": "object",
      "description": "A record of an AI-powered audit.",
      "properties": {
        "userId": { "type": "string" },
        "input": {
          "type": "object",
          "properties": {
            "situationDetails": { "type": "string" },
            "langPreference": { "type": "string" }
          },
          "required": ["situationDetails", "langPreference"]
        },
        "output": {
          "type": "object",
          "properties": {
            "diagnosis_title": { "type": "string" },
            "brutal_diagnosis": { "type": "string" },
            "opportunity_cost_idr": { "type": "number" },
            "growth_loss_percentage": { "type": "number" },
            "dark_analogy": { "type": "string" },
            "strategic_commands": { "type": "array", "items": { "type": "string" } }
          }
        },
        "type": {
          "type": "string",
          "enum": ["standard", "deep_audit"]
        },
        "timestamp": { "type": "number" }
      },
      "required": ["userId", "input", "output", "type", "timestamp"]
    },
    "ActiveCommand": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ActiveCommand",
      "type": "object",
      "description": "An actionable command assigned to a user.",
      "properties": {
        "userId": { "type": "string" },
        "auditId": { "type": "string" },
        "task": { "type": "string" },
        "deadline": { "type": "number" },
        "status": { "type": "string", "enum": ["pending", "completed", "failed"] },
        "isPremiumFeature": { "type": "boolean" }
      },
      "required": ["userId", "auditId", "task", "deadline", "status", "isPremiumFeature"]
    }
  },
  "auth": {
    "providers": ["password", "anonymous"]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": { "$ref": "#/backend/entities/User" },
          "description": "Stores user profile."
        }
      },
      {
        "path": "/users/{userId}/stats/{statsId}",
        "definition": {
          "entityName": "UserStats",
          "schema": { "$ref": "#/backend/entities/UserStats" },
          "description": "User statistics."
        }
      },
      {
        "path": "/users/{userId}/subscriptions/{subscriptionId}",
        "definition": {
          "entityName": "Subscription",
          "schema": { "$ref": "#/backend/entities/Subscription" },
          "description": "Subscription details."
        }
      },
      {
        "path": "/users/{userId}/audit_logs/{auditId}",
        "definition": {
          "entityName": "AuditLog",
          "schema": { "$ref": "#/backend/entities/AuditLog" },
          "description": "User audit history."
        }
      },
      {
        "path": "/users/{userId}/active_commands/{commandId}",
        "definition": {
          "entityName": "ActiveCommand",
          "schema": { "$ref": "#/backend/entities/ActiveCommand" },
          "description": "User active commands."
        }
      }
    ]
  }
}
